!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.d3_timeseries=e(t.d3)}(this,function(t){"use strict";return function(){function e(t){return"function"==typeof t?t:function(e){return e[t]}}function a(t,e){var a="function"==typeof t?t:function(e){return e[t]};return function(t){return e(a(t))}}function r(t){return function(e){return e.hasOwnProperty(t)&&null!==e[t]&&!isNaN(e[t])}}function n(t){return function(e){return e[t]}}var i=["#a6cee3","#ff7f00","#b2df8a","#1f78b4","#fdbf6f","#33a02c","#cab2d6","#6a3d9a","#fb9a99","#e31a1c","#ffff99","#b15928"];return function(){function o(e){var i=e.aes;e.options.interpolate||(e.options.interpolate="linear");var o=t.line().x(a(i.x,v)).y(a(i.y,b)).interpolate(e.options.interpolate).defined(r(i.y));if(e.line=o,e.options.label=e.options.label||e.options.name||e.aes.label||e.aes.y,i.ci_up&&i.ci_down){var s=t.area().x(a(i.x,v)).y0(a(i.ci_down,b)).y1(a(i.ci_up,b)).interpolate(e.options.interpolate);e.ciArea=s}i.diff&&(e.diffAreas=[t.area().x(a(i.x,v)).y0(a(i.y,b)).y1(function(t){return b(t[i.y]>t[i.diff]?t[i.diff]:t[i.y])}).interpolate(e.options.interpolate),t.area().x(a(i.x,v)).y1(a(i.y,b)).y0(function(t){return b(t[i.y]<t[i.diff]?t[i.diff]:t[i.y])}).interpolate(e.options.interpolate)]),e.find=function(a){var r=(0,t.bisector(n(i.x)).left)(e.data,a)-1;return-1==r?null:r==e.data.length-1&&e.data.length>1&&Number(a)-Number(e.data[r][i.x])>Number(e.data[r][i.x])-Number(e.data[r-1][i.x])?null:e.data[r]}}function s(t){if(t.linepath)t.linepath.attr("d",t.line),t.ciArea&&t.cipath.attr("d",t.ciArea),t.diffAreas&&(t.diffpaths[0].attr("d",t.diffAreas[0]),t.diffpaths[1].attr("d",t.diffAreas[1]));else{t.aes;var e=w.append("path").datum(t.data).attr("class","d3_timeseries line").attr("d",t.line).attr("stroke",t.options.color).attr("stroke-linecap","round").attr("stroke-width",t.options.width||1.5).attr("fill","none");t.options.dashed&&(1==t.options.dashed||"dashed"==t.options.dashed?t["stroke-dasharray"]="5,5":"long"==t.options.dashed?t["stroke-dasharray"]="10,10":"dot"==t.options.dashed?t["stroke-dasharray"]="2,4":t["stroke-dasharray"]=t.options.dashed,e.attr("stroke-dasharray",t["stroke-dasharray"])),t.linepath=e,t.ciArea&&(t.cipath=w.insert("path",":first-child").datum(t.data).attr("class","d3_timeseries ci-area").attr("d",t.ciArea).attr("stroke","none").attr("fill",t.options.color).attr("opacity",t.options.ci_opacity||.3)),t.diffAreas&&(t.diffpaths=t.diffAreas.map(function(a,r){var n=(t.options.diff_colors?t.options.diff_colors:["green","red"])[r];return w.insert("path",function(){return e[0][0]}).datum(t.data).attr("class","d3_timeseries diff-area").attr("d",a).attr("stroke","none").attr("fill",n).attr("opacity",t.options.diff_opacity||.5)}))}}function l(t){var e=A.selectAll("circle.d3_timeseries.focusring");(e=null==t?e.data([]):e.data(g.map(function(e){return{x:t,item:e.find(t),aes:e.aes,color:e.options.color}}).filter(function(t){return void 0!==t.item&&null!==t.item&&null!==t.item[t.aes.y]&&!isNaN(t.item[t.aes.y])}))).transition().duration(50).attr("cx",function(t){return v(t.item[t.aes.x])}).attr("cy",function(t){return b(t.item[t.aes.y])}),e.enter().append("circle").attr("class","d3_timeseries focusring").attr("fill","none").attr("stroke-width",2).attr("r",5).attr("stroke",n("color")),e.exit().remove()}function d(t){if(null==t)M.style("opacity",0);else{var e=g.map(function(e){return{item:e.find(t),aes:e.aes,options:e.options}});M.style("opacity",.9).style("left",x.left+5+v(t)+"px").style("top","0px").html(P(t,e))}}function f(){var e=b.copy().range([h-y,0]),n=g[0],i=t.line().x(a(n.aes.x,F)).y(a(n.aes.y,e)).interpolate(n.options.interpolate).defined(r(n.aes.y)),o=N.insert("path",":first-child").datum(n.data).attr("class","d3_timeseries.line").attr("transform","translate(0,"+y+")").attr("d",i).attr("stroke",n.options.color).attr("stroke-width",n.options.width||1.5).attr("fill","none");n.hasOwnProperty("stroke-dasharray")&&o.attr("stroke-dasharray",n["stroke-dasharray"])}function c(){var e=t.mouse(_[0][0])[0];e=v.invert(e),E.datum({x:e,visible:!0}),E.update(),l(e),d(e)}function p(){E.datum({x:null,visible:!1}),E.update(),l(null),d(null)}var u=480,m=600,h=80,y=10,x={top:10,bottom:20,left:30,right:10},g=[],b=t.scaleLinear(),v=t.scaleTime();b.label="",v.label="";var k,_,w,A,N,E,F,M,L=t.brush();b.setformat=function(t){return t.toLocaleString()},v.setformat=v.tickFormat();var P=function(e,a){var r='<table style="border:none">'+a.filter(function(t){return void 0!==t.item&&null!==t.item}).map(function(t){return'<tr><td style="color:'+t.options.color+'">'+t.options.label+' </td><td style="color:#333333;text-align:right">'+b.setformat(t.item[t.aes.y])+"</td></tr>"}).join("")+"</table>";return"<h4>"+v.setformat(t.time.day(e))+"</h4>"+r},j=function(a){g=g.map(function(a){var r=t.extent(a.data.map(e(a.aes.y)));return a.min=r[0],a.max=r[1],r=t.extent(a.data.map(e(a.aes.x))),a.dateMin=r[0],a.dateMax=r[1],a}),b.range([u-x.top-x.bottom-h-y,0]).domain([t.min(g.map(n("min"))),t.max(g.map(n("max")))]).nice(),v.range([0,m-x.left-x.right]).domain([t.min(g.map(n("dateMin"))),t.max(g.map(n("dateMax")))]).nice(),b.fixedomain&&(1==b.fixedomain.length&&b.fixedomain.push(b.domain()[1]),b.domain(b.fixedomain)),v.fixedomain&&v.domain(b.fixedomain),F=v.copy(),(k=t.select(a).append("svg").attr("width",m).attr("height",u)).append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",m-x.left-x.right).attr("height",u-x.bottom-h-y).attr("y",-x.top),_=k.insert("g","rect.mouse-catch").attr("transform","translate("+x.left+","+x.top+")").attr("clip-path","url(#clip)"),w=_.append("g"),A=_.append("g"),N=k.append("g").attr("transform","translate("+x.left+","+(u-h-x.bottom)+")"),(E=k.append("g").datum({x:new Date,visible:!1})).append("line").attr("x1",0).attr("x2",0).attr("y1",b.range()[0]).attr("y2",b.range()[1]).attr("class","d3_timeseries mousevline"),E.update=function(){this.attr("transform",function(t){return"translate("+(x.left+v(t.x))+","+x.top+")"}).style("opacity",function(t){return t.visible?1:0})},E.update();var r=t.axisBottom().scale(v).tickFormat(v.setformat),i=t.axisLeft().scale(b).tickFormat(b.setformat);L.x(F).on("brush",function(){v.domain(L.empty()?F.domain():L.extent()),g.forEach(s),k.select(".focus.x.axis").call(r),E.update(),l()}),k.append("g").attr("class","d3_timeseries focus x axis").attr("transform","translate("+x.left+","+(u-x.bottom-h-y)+")").call(r),N.append("g").attr("class","d3_timeseries x axis").attr("transform","translate(0,"+h+")").call(r),N.append("g").attr("class","d3_timeseries brush").call(L).selectAll("rect").attr("y",y).attr("height",h-y),k.append("g").attr("class","d3_timeseries y axis").attr("transform","translate("+x.left+","+x.top+")").call(i).append("text").attr("transform","rotate(-90)").attr("x",-x.top-t.mean(b.range())).attr("dy",".71em").attr("y",5-x.left).style("text-anchor","middle").text(b.label),k.append("rect").attr("width",m).attr("class","d3_timeseries mouse-catch").attr("height",u-h).style("opacity",0).on("mousemove",c).on("mouseout",p),M=t.select(a).style("position","relative").append("div").attr("class","d3_timeseries tooltip").style("opacity",0),g.forEach(o),g.forEach(s),f()};j.width=function(t){return arguments.length?(m=t,j):m},j.height=function(t){return arguments.length?(u=t,j):u},j.margin=function(t){return arguments.length?(x=t,j):x},t.keys(x).forEach(function(t){j.margin[t]=function(e){return arguments.length?(x[t]=e,j):x[t]}});var O=function(t){return{tickFormat:function(e){return arguments.length?(t.setformat=e,j):t.setformat},label:function(e){return arguments.length?(t.label=e,j):t.label},domain:function(e){return!arguments.length&&t.fixedomain?t.fixedomain:arguments.length?(t.fixedomain=e,j):null}}};return j.yscale=O(b),j.xscale=O(v),j.addSerie=function(t,e,a){return!t&&g.length>0&&(t=g[0].data),a.color||(a.color=i[g.length%i.length]),g.push({data:t,aes:e,options:a}),j},j}}});
